<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Chamados - ProduÃ§Ã£o</title>

<style>
:root {
    --bg: #eef1f5;
    --card: #ffffff;
    --primary: #2563eb;
    --danger: #dc2626;
    --text: #1f2937;
    --muted: #6b7280;
    --border: #e5e7eb;
    --novo: #e0f2fe;
}

* {
    box-sizing: border-box;
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
}

body {
    margin: 0;
    background: var(--bg);
}

/* HEADER */
header {
    background: var(--card);
    border-bottom: 1px solid var(--border);
    padding: 16px 20px;
}

.container {
    max-width: 1500px;
    margin: auto;
    padding: 20px;
}

.card {
    background: var(--card);
    border-radius: 14px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    overflow: hidden;
}

/* TABLE */
.table-wrapper {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1200px;
}

th, td {
    padding: 14px;
    font-size: 14px;
    border-bottom: 1px solid var(--border);
}

th {
    background: #f9fafb;
    color: var(--muted);
}

tr.novo {
    background: var(--novo);
}

button.finalizar {
    background: var(--danger);
    color: #fff;
    border: none;
    padding: 8px 14px;
    border-radius: 8px;
    cursor: pointer;
}

/* MODAL */
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: #fff;
    border-radius: 14px;
    width: 100%;
    max-width: 500px;
    padding: 24px;
}

.modal-content h2 {
    margin-top: 0;
}

.modal-content input,
.modal-content textarea {
    width: 100%;
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 8px;
    border: 1px solid var(--border);
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.modal-actions button {
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
}

.salvar {
    background: var(--primary);
    color: #fff;
}

.cancelar {
    background: #9ca3af;
    color: #fff;
}
</style>
</head>
<body>

<header>
    <h1>ðŸ“‹ Painel de Chamados â€“ ProduÃ§Ã£o</h1>
</header>

<div class="container">
    <div class="card">
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Supervisor</th>
                        <th>GalpÃ£o</th>
                        <th>Grupo</th>
                        <th>MÃ¡quina</th>
                        <th>DescriÃ§Ã£o</th>
                        <th>Data</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody id="listaChamados"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- MODAL FINALIZAR -->
<div class="modal" id="modal">
    <div class="modal-content">
        <h2>Finalizar Atendimento</h2>

        <input type="text" id="mecanico" placeholder="Nome do mecÃ¢nico" required>
        <textarea id="solucao" placeholder="Descreva o que foi feito" required></textarea>

        <div class="modal-actions">
            <button class="cancelar" onclick="fecharModal()">Cancelar</button>
            <button class="salvar" onclick="finalizarChamado()">Concluir</button>
        </div>
    </div>
</div>

<script>
let chamadoSelecionado = null;

async function carregarChamados() {
    const res = await fetch("/api/listar");
    const chamados = await res.json();

    const tbody = document.getElementById("listaChamados");
    tbody.innerHTML = "";

    chamados
      .filter(c => c.status !== "Finalizado")
      .forEach(c => {
        tbody.innerHTML += `
            <tr>
                <td>${c.supervisor}</td>
                <td>${c.galpao}</td>
                <td>${c.grupo}</td>
                <td>${c.maquina}</td>
                <td>${c.descricao}</td>
                <td>${new Date(c.criado_em).toLocaleString()}</td>
                <td>
                    <button class="finalizar" onclick="abrirModal(${c.id})">
                        Finalizar
                    </button>
                </td>
            </tr>
        `;
    });
}

function abrirModal(id) {
    chamadoSelecionado = id;
    document.getElementById("modal").classList.add("active");
}

function fecharModal() {
    document.getElementById("modal").classList.remove("active");
    mecanico.value = "";
    solucao.value = "";
}

async function finalizarChamado() {
    if (!mecanico.value || !solucao.value) {
        alert("Preencha todos os campos");
        return;
    }

    await fetch("/api/chamados/finalizar", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            id: chamadoSelecionado,
            mecanico: mecanico.value,
            solucao: solucao.value
        })
    });

    fecharModal();
    carregarChamados();
}

carregarChamados();
setInterval(carregarChamados, 10000);
</script>

</body>
</html>
